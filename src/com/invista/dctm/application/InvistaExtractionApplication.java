
package com.invista.dctm.application;
//import com.invista.dctm.extraction.ReadReport;

import java.util.HashSet;
import java.util.Properties;
import java.util.Set;

import org.apache.log4j.Logger;

import com.documentum.fc.client.IDfSession;
import com.documentum.fc.client.IDfSessionManager;
import com.invista.dctm.extraction.TypeBasedExport;
import com.invista.dctm.extraction.TypeBasedImport;
import com.invista.dctm.session.CreateSourceDCTMSession;
import com.invista.file.util.FileUtil;
import com.invista.file.util.ReadPropertiesFile;

/**
 * Author : ravikishore karnam
 * @param args
 */
public class InvistaExtractionApplication {
	public static String CONTENT_FOLDER ="";
	public static String METADATA_FOLDER ="";
	public static Set failedObjectIds =null;
	private static Logger log = Logger.getLogger(InvistaExtractionApplication.class);
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		System.out.println("Invista Extractio0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 n Application : started");
		log.info("Invista Extraction Application : started");
		//repository information variables
		String repository ="";
		String userName = "";
		String password = "";
		//startdate and enddate
		String startDate = "";
		String endDate = "";
		//Object Type
		String objectType = "";
		String importFolderPath ="";
		
		Set objectIds = null;
		//IDfSessionManager
		IDfSessionManager sMgr =null;
		//IDfSession
		IDfSession session =null;
		
		// List of properties files 
		String appPropFileName ="\\application.properties";
		try{
		failedObjectIds = new HashSet();
		//Reading ApplicationProperties file application.properties
		System.out.println("Reading ApplicationProperties..");
		Properties appProperties = ReadPropertiesFile.readProperties(appPropFileName);
		//Creating required application folders
		System.out.println("Creating required application folders..");
		FileUtil.createDirStructure(appProperties.getProperty("application_root"));
		FileUtil.createDirStructure(appProperties.getProperty("content"));
		CONTENT_FOLDER = appProperties.getProperty("content");
		
		FileUtil.createDirStructure(appProperties.getProperty("metadata"));
		METADATA_FOLDER = appProperties.getProperty("metadata");
		
		FileUtil.createDirStructure(appProperties.getProperty("reports"));
		FileUtil.createDirStructure(appProperties.getProperty("logs"));
		System.out.println("Creating required application folders Completed");
		
		System.out.println("Reading repository Information..");
		repository = appProperties.getProperty("repository");
		userName = appProperties.getProperty("username");
		password = appProperties.getProperty("password");
		
		startDate = appProperties.getProperty("start_date");
		endDate = appProperties.getProperty("end_date");
		objectType = appProperties.getProperty("object_type");
		importFolderPath = appProperties.getProperty("import_folder_path");
		String attrNames ="";



		if(objectType.equals("document")){
			//System.out.println("object type="+objectType);
			attrNames = "r_object_id,object_name";
		}else if(objectType.equals("dm_document")){
			attrNames = "r_object_id,object_name";
		}
		else if(objectType.equals("drawings")){
			attrNames = "r_object_id,object_name";
			
		}
		System.out.println(objectType);
		System.out.println(userName);
		System.out.println(password);
		System.out.println(repository);
		
		session = CreateSourceDCTMSession.getSession(userName, password, repository);
		log.info("session object initialized successfully");
		
		sMgr = CreateSourceDCTMSession.smgr;
		log.info("session manager object initialized successfully");
		
		objectIds=TypeBasedImport.getErrorObjects("E:/Wilton/ObjectIds.txt");

		System.out.println("No of Object IDs returned:"+objectIds.size());

		
		//Exports list of objects in set
		TypeBasedExport.exportListOfObjects(objectIds, objectType, attrNames, CONTENT_FOLDER, session);

		// Extract Metadata to Text File
		//ExtractMetadataToTextFile.extractMetadataToTextFile(objectIds, objectType, attrNames, METADATA_FOLDER, session);
		

		System.out.println("Invista Extraction Application : finished");
		log.info("Invista Extraction Application : finished");
		}
		catch(Exception e){
			
			log.info("ERROR");
			log.error(e.getMessage());
			e.printStackTrace();
		}
		finally{
			sMgr.release(session);
			System.out.println("Session released successfully");
			//log.info("Session released successfully");
		}
	}

}

